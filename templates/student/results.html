{% extends 'base.html' %}
{% block title %}Results â€” ShikshyaHub{% endblock %}
{% block role_label %}Student Portal{% endblock %}
{% block page_title %}My Results{% endblock %}
{% block sidebar_nav %}
<div class="sidebar-section-label">Overview</div>
<a href="{{ url_for('student_dashboard') }}"><span class="nav-icon">ğŸ </span> Dashboard</a>
<div class="sidebar-section-label">Learning</div>
<a href="{{ url_for('student_subjects') }}"><span class="nav-icon">ğŸ“š</span> My Subjects</a>
<a href="{{ url_for('student_tasks') }}"><span class="nav-icon">ğŸ“</span> Tasks
  {% if notif_by_type.get('assignment') %}<span class="nav-badge">{{ notif_by_type['assignment'] }}</span>{% endif %}
</a>
<div class="sidebar-section-label">Academic</div>
<a href="{{ url_for('student_attendance') }}"><span class="nav-icon">âœ…</span> Attendance</a>
<a href="{{ url_for('student_results') }}"><span class="nav-icon">ğŸ“Š</span> Results
  {% if notif_by_type.get('result') %}<span class="nav-badge">{{ notif_by_type['result'] }}</span>{% endif %}
</a>
<a href="{{ url_for('student_timetable') }}"><span class="nav-icon">ğŸ“…</span> Timetable</a>
<div class="sidebar-section-label">Administration</div>
<a href="{{ url_for('student_notices') }}"><span class="nav-icon">ğŸ“¢</span> Notices
  {% if notif_by_type.get('notice') %}<span class="nav-badge">{{ notif_by_type['notice'] }}</span>{% endif %}
</a>
<a href="{{ url_for('student_fees') }}"><span class="nav-icon">ğŸ’°</span> Fees
  {% if notif_by_type.get('fee') %}<span class="nav-badge">{{ notif_by_type['fee'] }}</span>{% endif %}
</a>
<a href="{{ url_for('student_profile') }}"><span class="nav-icon">ğŸ‘¤</span> Profile</a>
{% endblock %}
{% block content %}
<div class="page-header"><div><h1>My Results</h1><p>Semester-wise marks and GPA</p></div></div>

<!-- Semester GPA Summary -->
{% if semesters %}
<div class="grid-auto mb-4">
  {% for sem in semesters %}
  <div class="stat-card">
    <div class="icon" style="background:var(--gold-pale);">ğŸ“</div>
    <div>
      <div class="stat-val">{{ '%.2f'|format(sem.avg_gpa) }}</div>
      <div class="stat-label">Sem {{ sem.semester }} GPA</div>
    </div>
  </div>
  {% endfor %}
</div>
{% endif %}

<!-- Results Table -->
{% for sem in semesters %}
<div class="card mb-4">
  <div class="card-header">
    <span class="card-title">ğŸ“Š Semester {{ sem.semester }} Results</span>
    <span style="font-size:.85rem;color:var(--gold);font-weight:700;">GPA: {{ '%.2f'|format(sem.avg_gpa) }}</span>
  </div>
  <div class="table-wrapper">
    <table>
      <thead><tr><th>Subject</th><th>Internal (20)</th><th>Assignment (20)</th><th>Exam (60)</th><th>Total (100)</th><th>Grade</th><th>GPA</th></tr></thead>
      <tbody>
        {% for r in results if r.semester == sem.semester %}
        <tr>
          <td style="font-weight:600;color:var(--navy);">{{ r.subject_name }}</td>
          <td>{{ r.internal_marks }}</td>
          <td>{{ r.assignment_marks }}</td>
          <td>{{ r.exam_marks }}</td>
          <td style="font-weight:700;color:var(--navy);">{{ r.total_marks }}</td>
          <td><span class="badge badge-{{ 'success' if r.grade in ['A+','A'] else 'warning' if r.grade.startswith('B') else 'danger' if r.grade=='F' else 'navy' }}">{{ r.grade }}</span></td>
          <td style="font-weight:700;color:var(--gold);">{{ r.gpa }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% else %}
<div class="card" style="padding:48px;text-align:center;">
  <div style="font-size:3rem;opacity:.3;">ğŸ“Š</div>
  <p style="color:var(--text-light);margin-top:12px;">No published results yet. Check back after exam season.</p>
</div>
{% endfor %}
{% endblock %}

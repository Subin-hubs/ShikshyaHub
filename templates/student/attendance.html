{% extends 'base.html' %}
{% block title %}Attendance â€” ShikshyaHub{% endblock %}
{% block role_label %}Student Portal{% endblock %}
{% block page_title %}My Attendance{% endblock %}
{% block sidebar_nav %}
<div class="sidebar-section-label">Overview</div>
<a href="{{ url_for('student_dashboard') }}"><span class="nav-icon">ğŸ </span> Dashboard</a>
<div class="sidebar-section-label">Learning</div>
<a href="{{ url_for('student_subjects') }}"><span class="nav-icon">ğŸ“š</span> My Subjects</a>
<a href="{{ url_for('student_tasks') }}"><span class="nav-icon">ğŸ“</span> Tasks
  {% if notif_by_type.get('assignment') %}<span class="nav-badge">{{ notif_by_type['assignment'] }}</span>{% endif %}
</a>
<div class="sidebar-section-label">Academic</div>
<a href="{{ url_for('student_attendance') }}"><span class="nav-icon">âœ…</span> Attendance</a>
<a href="{{ url_for('student_results') }}"><span class="nav-icon">ğŸ“Š</span> Results
  {% if notif_by_type.get('result') %}<span class="nav-badge">{{ notif_by_type['result'] }}</span>{% endif %}
</a>
<a href="{{ url_for('student_timetable') }}"><span class="nav-icon">ğŸ“…</span> Timetable</a>
<div class="sidebar-section-label">Administration</div>
<a href="{{ url_for('student_notices') }}"><span class="nav-icon">ğŸ“¢</span> Notices
  {% if notif_by_type.get('notice') %}<span class="nav-badge">{{ notif_by_type['notice'] }}</span>{% endif %}
</a>
<a href="{{ url_for('student_fees') }}"><span class="nav-icon">ğŸ’°</span> Fees
  {% if notif_by_type.get('fee') %}<span class="nav-badge">{{ notif_by_type['fee'] }}</span>{% endif %}
</a>
<a href="{{ url_for('student_profile') }}"><span class="nav-icon">ğŸ‘¤</span> Profile</a>
{% endblock %}
{% block content %}
<div class="page-header"><div><h1>My Attendance</h1><p>Subject-wise and overall attendance overview</p></div></div>

<!-- Subject-wise stats -->
{% if subject_stats %}
<div class="card mb-4">
  <div class="card-header"><span class="card-title">ğŸ“Š Subject-wise Attendance</span></div>
  <div class="card-body" style="display:flex;flex-direction:column;gap:14px;">
    {% for s in subject_stats %}
    {% set pct = ((s.present / s.total) * 100)|round(1) if s.total else 0 %}
    <div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
        <span style="font-weight:600;color:var(--navy);font-size:.9rem;">{{ s.name }}</span>
        <div style="display:flex;align-items:center;gap:10px;">
          <span style="font-size:.8rem;color:var(--text-light);">{{ s.present }}/{{ s.total }} classes</span>
          <span style="font-weight:700;color:{{ 'var(--success)' if pct >= 75 else 'var(--danger)' }};">{{ pct }}%</span>
        </div>
      </div>
      <div class="progress"><div class="progress-bar progress-bar-{{ 'success' if pct >= 75 else 'danger' }}" style="width:{{ pct }}%;"></div></div>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

<!-- Attendance Records -->
<div class="card">
  <div class="card-header"><span class="card-title">ğŸ“‹ Attendance Records</span></div>
  <div class="table-wrapper">
    <table>
      <thead><tr><th>Date</th><th>Subject</th><th>Status</th></tr></thead>
      <tbody>
        {% for a in attendance %}
        <tr>
          <td style="font-weight:600;color:var(--navy);">{{ a.date }}</td>
          <td>{{ a.subject_name }}</td>
          <td>
            {% if a.status=='present' %}<span class="badge badge-success">âœ“ Present</span>
            {% elif a.status=='absent' %}<span class="badge badge-danger">âœ— Absent</span>
            {% else %}<span class="badge badge-warning">âš  Late</span>{% endif %}
          </td>
        </tr>
        {% else %}
        <tr><td colspan="3" class="text-center" style="padding:40px;color:var(--text-light);">No attendance records found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

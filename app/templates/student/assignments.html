{% extends "base.html" %}

{% block content %}
<div class="page-container">
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark"
        style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);">
        <div class="container-fluid">
            <a class="navbar-brand" href="{{ url_for('student.dashboard') }}">
                <i class="fas fa-graduation-cap"></i> ShikshyaHub
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('student.dashboard') }}">Dashboard</a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('student.courses') }}">Courses</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('student.attendance') }}">Attendance</a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('student.grades') }}">Grades</a></li>
                    <li class="nav-item"><a class="nav-link active"
                            href="{{ url_for('student.assignments') }}">Assignments</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('student.notices') }}">Notices</a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                            data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle"></i> {{ current_user.name }}
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="userDropdown">
                            <li><a class="dropdown-item" href="#">Profile</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Sidebar Toggle Button -->
    <button class="sidebar-toggle" id="sidebarToggle">
        <i class="fas fa-chevron-left"></i>
    </button>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h5>Student Menu</h5>
        </div>
        <ul class="sidebar-menu">
            <li><a href="{{ url_for('student.dashboard') }}"><i class="fas fa-home"></i> Dashboard</a></li>
            <li><a href="{{ url_for('student.courses') }}"><i class="fas fa-book"></i> My Courses</a></li>
            <li><a href="{{ url_for('student.attendance') }}"><i class="fas fa-clipboard-check"></i> Attendance</a></li>
            <li><a href="{{ url_for('student.grades') }}"><i class="fas fa-star"></i> Grades</a></li>
            <li><a href="{{ url_for('student.assignments') }}" class="active"><i class="fas fa-tasks"></i>
                    Assignments</a></li>
            <li><a href="{{ url_for('student.notices') }}"><i class="fas fa-bell"></i> Notices</a></li>
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="content-wrapper">
            <!-- Page Header -->
            <div class="page-header">
                <h1><i class="fas fa-tasks"></i> My Assignments</h1>
                <p>View and submit your course assignments</p>
            </div>

            <!-- Flash Messages -->
            {% if get_flashed_messages() %}
            {% for message in get_flashed_messages() %}
            <div class="alert alert-info alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endfor %}
            {% endif %}

            <!-- Summary Cards -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="summary-card">
                        <div class="summary-icon"
                            style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);">
                            <i class="fas fa-list-check"></i>
                        </div>
                        <div class="summary-content">
                            <h3>{{ assignments|length }}</h3>
                            <p>Total Assignments</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="summary-card">
                        <div class="summary-icon"
                            style="background: linear-gradient(135deg, #0dcaf0 0%, #0ba5e9 100%);">
                            <i class="fas fa-hourglass-end"></i>
                        </div>
                        <div class="summary-content">
                            <h3 id="upcomingCount">0</h3>
                            <p>Upcoming</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="summary-card">
                        <div class="summary-icon"
                            style="background: linear-gradient(135deg, #059669 0%, #047857 100%);">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="summary-content">
                            <h3 id="submittedCount">0</h3>
                            <p>Submitted</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="summary-card">
                        <div class="summary-icon"
                            style="background: linear-gradient(135deg, #ea580c 0%, #dc2626 100%);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="summary-content">
                            <h3 id="overdueCount">0</h3>
                            <p>Overdue</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Assignments List -->
            {% if assignments %}
            <div class="card">
                <div class="card-header"
                    style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; border-radius: 8px 8px 0 0;">
                    <h5><i class="fas fa-list"></i> Active Assignments</h5>
                </div>
                <div class="card-body p-0">
                    <div class="assignments-list">
                        {% for assignment in assignments %}
                        {% if assignment.course %}
                        <div class="assignment-item">
                            <div class="assignment-left">
                                <div class="assignment-icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="assignment-info">
                                    <h4>{{ assignment.title }}</h4>
                                    <p class="assignment-course">
                                        <i class="fas fa-book"></i> {{ assignment.course.name }} ({{
                                        assignment.course.code }})
                                    </p>
                                    {% if assignment.due_date %}
                                    {% set days_left = (assignment.due_date.date() - now().date()).days %}
                                    <p class="assignment-deadline">
                                        <i class="fas fa-calendar-alt"></i>
                                        Due: {{ assignment.due_date.strftime('%b %d, %Y at %I:%M %p') }}
                                        {% if days_left > 0 %}
                                        <span class="badge"
                                            style="background-color: #0dcaf0; color: white; margin-left: 10px;">{{
                                            days_left }} days left</span>
                                        {% elif days_left == 0 %}
                                        <span class="badge"
                                            style="background-color: #ea580c; color: white; margin-left: 10px;">Due
                                            Today</span>
                                        {% else %}
                                        <span class="badge"
                                            style="background-color: #dc2626; color: white; margin-left: 10px;">{{
                                            -days_left }} days overdue</span>
                                        {% endif %}
                                    </p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="assignment-right">
                                <button class="btn-submit" data-assignment-id="{{ assignment.id }}"
                                    data-bs-toggle="modal" data-bs-target="#submitModal">
                                    <i class="fas fa-upload"></i> Submit
                                </button>
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% else %}
            <div class="alert alert-info" role="alert">
                <i class="fas fa-info-circle"></i> No assignments available. Check back later!
            </div>
            {% endif %}

            <!-- Instructions Card -->
            <div class="row mt-5">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header" style="background-color: #f3f4f6; border-bottom: 2px solid #2563eb;">
                            <h5 style="color: #2563eb;"><i class="fas fa-lightbulb"></i> Submission Tips</h5>
                        </div>
                        <div class="card-body">
                            <ul style="padding-left: 20px;">
                                <li>Submit assignments before the deadline</li>
                                <li>Check file format requirements</li>
                                <li>Keep file size within limits</li>
                                <li>Provide clear and organized solutions</li>
                                <li>Save a copy of your submission</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header" style="background-color: #f3f4f6; border-bottom: 2px solid #2563eb;">
                            <h5 style="color: #2563eb;"><i class="fas fa-question-circle"></i> Need Help?</h5>
                        </div>
                        <div class="card-body">
                            <p>If you have questions about any assignment:</p>
                            <ul style="padding-left: 20px;">
                                <li>Contact your course instructor</li>
                                <li>Check course discussion forum</li>
                                <li>Visit during office hours</li>
                                <li>Email the teaching assistant</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Submit Assignment Modal -->
<div class="modal fade" id="submitModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"
                style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; border: none;">
                <h5 class="modal-title"><i class="fas fa-upload"></i> Submit Assignment</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="submitForm">
                    <div class="mb-3">
                        <label for="assignmentFile" class="form-label">Select File</label>
                        <input type="file" class="form-control" id="assignmentFile" required>
                        <small class="form-text text-muted">Accepted formats: PDF, DOC, DOCX, TXT, ZIP (Max
                            10MB)</small>
                    </div>
                    <div class="mb-3">
                        <label for="submitNotes" class="form-label">Additional Notes (Optional)</label>
                        <textarea class="form-control" id="submitNotes" rows="3"
                            placeholder="Add any notes or comments..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="submitBtn"
                    style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); border: none;">
                    <i class="fas fa-check"></i> Submit Assignment
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    body {
        background-color: #f8fafc;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .page-container {
        display: flex;
        min-height: 100vh;
    }

    .navbar {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        position: relative;
        z-index: 100;
    }

    .sidebar {
        width: 260px;
        background-color: white;
        padding: 20px 0;
        box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
        position: fixed;
        left: 0;
        top: 0;
        height: 100vh;
        overflow-y: auto;
        margin-top: 56px;
        transition: transform 0.3s ease;
    }

    .sidebar.show {
        display: block;
    }

    .sidebar-toggle {
        position: fixed;
        left: 10px;
        top: 70px;
        background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
        color: white;
        border: none;
        padding: 10px 12px;
        border-radius: 50%;
        cursor: pointer;
        z-index: 99;
        font-size: 18px;
        transition: all 0.3s ease;
    }

    .sidebar-toggle:hover {
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .main-content {
        flex: 1;
        margin-left: 260px;
        margin-top: 56px;
        padding: 30px;
    }

    .summary-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        display: flex;
        align-items: center;
        gap: 15px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
    }

    .summary-card:hover {
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        transform: translateY(-2px);
    }

    .summary-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 28px;
    }

    .summary-content h3 {
        margin: 0;
        font-size: 24px;
        font-weight: 700;
        color: #1e293b;
    }

    .summary-content p {
        margin: 5px 0 0 0;
        color: #64748b;
        font-size: 14px;
    }

    .card {
        border: none;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border-radius: 12px;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .card:hover {
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }

    .card-header {
        padding: 20px;
        font-weight: 600;
    }

    .card-body {
        padding: 20px;
    }

    .assignments-list {
        display: flex;
        flex-direction: column;
        gap: 0;
    }

    .assignment-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
        transition: all 0.3s ease;
    }

    .assignment-item:last-child {
        border-bottom: none;
    }

    .assignment-item:hover {
        background-color: #f9fafb;
    }

    .assignment-left {
        display: flex;
        align-items: flex-start;
        gap: 15px;
        flex: 1;
    }

    .assignment-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
        flex-shrink: 0;
    }

    .assignment-info h4 {
        margin: 0 0 5px 0;
        font-size: 16px;
        font-weight: 700;
        color: #1e293b;
    }

    .assignment-info p {
        margin: 3px 0;
        font-size: 13px;
        color: #64748b;
    }

    .assignment-course {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .assignment-deadline {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .assignment-right {
        margin-left: 20px;
    }

    .btn-submit {
        background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 13px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        white-space: nowrap;
    }

    .btn-submit:hover {
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        transform: translateY(-2px);
        color: white;
        text-decoration: none;
    }

    .page-header {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #e5e7eb;
    }

    .page-header h1 {
        font-size: 32px;
        font-weight: 700;
        color: #1e293b;
        margin: 0 0 10px 0;
    }

    .page-header p {
        color: #64748b;
        margin: 0;
    }

    .sidebar-header {
        padding: 0 20px 20px 20px;
        border-bottom: 2px solid #e5e7eb;
    }

    .sidebar-header h5 {
        color: #1e293b;
        font-weight: 700;
        margin: 0;
    }

    .sidebar-menu {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .sidebar-menu li {
        margin: 0;
    }

    .sidebar-menu li a {
        display: block;
        padding: 12px 20px;
        color: #64748b;
        text-decoration: none;
        transition: all 0.3s ease;
        border-left: 3px solid transparent;
    }

    .sidebar-menu li a:hover,
    .sidebar-menu li a.active {
        background-color: #f0f9ff;
        color: #2563eb;
        border-left-color: #2563eb;
        padding-left: 17px;
    }

    .modal-content {
        border-radius: 12px;
        border: none;
    }

    .modal-body {
        padding: 25px;
    }

    .modal-footer {
        padding: 15px 25px;
        border-top: 1px solid #e5e7eb;
    }

    @media (max-width: 768px) {
        .sidebar {
            width: 100%;
            position: fixed;
            left: 0;
            top: 56px;
            height: calc(100vh - 56px);
            transform: translateX(-100%);
            z-index: 98;
        }

        .sidebar.show {
            transform: translateX(0);
        }

        .main-content {
            margin-left: 0;
            padding: 20px;
        }

        .page-header h1 {
            font-size: 24px;
        }

        .assignment-item {
            flex-direction: column;
            align-items: flex-start;
        }

        .assignment-right {
            margin-left: 0;
            margin-top: 15px;
            width: 100%;
        }

        .btn-submit {
            width: 100%;
            justify-content: center;
        }
    }
</style>

<script>
    // Sidebar Toggle
    document.getElementById('sidebarToggle').addEventListener('click', () => {
        document.getElementById('sidebar').classList.toggle('show');
    });

    // Get current date (simplified - in production use proper datetime)
    function now() {
        return new Date();
    }

    // Toast Notifications
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(alert => {
        setTimeout(() => {
            alert.style.transition = 'opacity 0.5s ease';
            alert.style.opacity = '0';
            setTimeout(() => alert.remove(), 500);
        }, 5000);
    });

    // Submit assignment
    document.getElementById('submitBtn').addEventListener('click', function () {
        const file = document.getElementById('assignmentFile').files[0];
        if (!file) {
            alert('Please select a file');
            return;
        }

        const formData = new FormData();
        formData.append('file', file);

        // TODO: Send to server
        alert('Assignment submitted successfully!');
        const modal = bootstrap.Modal.getInstance(document.getElementById('submitModal'));
        modal.hide();
    });
</script>
{% endblock %}